# Template: Capacity Planning Guide
# Template ID: capacity_planning
# Intent Type: practitioner
# Variables Required: {{user_count}}, {{deployment_scale}}, {{odoo_version}}

metadata:
  title: "Odoo {{odoo_version}} Server for {{user_count}} Users: Hardware & Architecture Guide"
  description: "Right-size Odoo {{odoo_version}} for {{user_count}} users in 60 minutes. Precise CPU/RAM/storage calculations, cloud cost optimization, and scalability roadmap. Prevent 40% over-provisioning waste."
  intent_type: "practitioner"
  page_slug: "{{page_slug}}"
  draft_metadata:
    created_by: "pseo-bulk-generator"
    template_id: "capacity_planning"
    generation_mode: "template"
    confidence_level: "high"

static_data:
  # New naming convention (used by main_content_templates)
  user_count: "{{user_count}}"
  deployment_scale: "{{deployment_scale}}"
  odoo_version: "{{odoo_version}}"

  # Content section variables (for capacity_planning_templates.yml)
  recommended_cpu_cores: "{{recommended_cpu_cores}}"
  recommended_ram_gb: "{{recommended_ram_gb}}"
  recommended_disk_gb: "{{recommended_disk_gb}}"
  minimum_cpu_cores: "{{minimum_cpu_cores}}"
  minimum_ram_gb: "{{minimum_ram_gb}}"
  worker_processes: "{{worker_processes}}"
  worker_memory_mb: "{{worker_memory_mb}}"
  total_worker_memory_gb: "{{total_worker_memory_gb}}"
  remaining_ram_gb: "{{remaining_ram_gb}}"
  app_tier_ram_gb: "{{app_tier_ram_gb}}"
  database_connection_pool: "{{database_connection_pool}}"
  deployment_architecture: "{{deployment_architecture}}"
  scaling_strategy: "{{scaling_strategy}}"
  cost_optimization: "{{cost_optimization}}"
  architecture_recommendations: "{{architecture_recommendations}}"
  performance_context: "{{performance_context}}"
  scale_context: "{{scale_context}}"
  postgresql_version: "{{postgresql_version}}"

  # Legacy naming (for backward compatibility)
  software_name: "Odoo"
  architecture_type: "{{architecture_type}}"

  hardware_specifications:
    recommended:
      cpu_cores: "{{recommended_cpu_cores}}"
      ram_gb: "{{recommended_ram_gb}}"
      disk_gb: "{{recommended_disk_gb}}"
      disk_type: "SSD (NVMe preferred for database tier)"

    minimum:
      cpu_cores: "{{minimum_cpu_cores}}"
      ram_gb: "{{minimum_ram_gb}}"
      disk_gb: "{{minimum_disk_gb}}"
      disk_type: "SSD minimum"

  performance_parameters:
    database_connection_pool: "{{database_connection_pool}}"
    worker_processes: "{{worker_processes}}"
    worker_memory_mb: "{{worker_memory_mb}}"
    load_balancer_required: "{{load_balancer_required}}"

  architecture_tiers:
    - tier: "Application Tier"
      components:
        - "Odoo Worker Processes ({{worker_processes}} workers)"
        - "NGINX Reverse Proxy"
        - "Session Manager (Redis/Memcached)"
      resource_allocation: "{{recommended_cpu_cores}} CPU cores, {{app_tier_ram_gb}}GB RAM"

    - tier: "Database Tier"
      components:
        - "PostgreSQL {{postgresql_version}}"
        - "Connection Pooler (PgBouncer)"
        - "Backup Manager"
      resource_allocation: "Dedicated instance with high RAM for caching"

    - tier: "Storage Tier"
      components:
        - "File Store (uploaded documents)"
        - "Generated Reports Cache"
        - "Backup Storage"
      resource_allocation: "{{recommended_disk_gb}}GB with automatic expansion"

  scaling_triggers:
    - metric: "CPU Utilization"
      threshold: "> 70% sustained during business hours"
      action: "Add application server or upgrade instance"

    - metric: "RAM Usage"
      threshold: "> 85% (causes disk swap)"
      action: "Increase RAM or optimize PostgreSQL config"

    - metric: "Database Query Time"
      threshold: "> 500ms average"
      action: "Add indexes, optimize queries, or scale database tier"

    - metric: "Worker Queue Depth"
      threshold: "> 10 queued requests"
      action: "Increase worker count or add application servers"

  cloud_instance_recommendations:
    aws:
      small: "t3.medium (2 vCPU, 4GB RAM) - Up to 25 users"
      medium: "t3.xlarge (4 vCPU, 16GB RAM) - 25-100 users"
      large: "c5.2xlarge (8 vCPU, 16GB RAM) - 100-250 users"
      enterprise: "c5.4xlarge (16 vCPU, 32GB RAM) + Load balancer - 250+ users"

    azure:
      small: "Standard_B2s (2 vCPU, 4GB RAM) - Up to 25 users"
      medium: "Standard_D4s_v3 (4 vCPU, 16GB RAM) - 25-100 users"
      large: "Standard_F8s_v2 (8 vCPU, 16GB RAM) - 100-250 users"
      enterprise: "Standard_F16s_v2 (16 vCPU, 32GB RAM) + Application Gateway - 250+ users"

    gcp:
      small: "n1-standard-2 (2 vCPU, 7.5GB RAM) - Up to 25 users"
      medium: "n1-standard-4 (4 vCPU, 15GB RAM) - 25-100 users"
      large: "c2-standard-8 (8 vCPU, 32GB RAM) - 100-250 users"
      enterprise: "c2-standard-16 (16 vCPU, 64GB RAM) + Cloud Load Balancing - 250+ users"

  performance_optimization_checklist:
    - task: "Enable PostgreSQL query caching"
      impact: "20-30% query performance improvement"

    - task: "Configure Odoo worker limits"
      impact: "Prevents memory exhaustion, improves stability"

    - task: "Implement CDN for static assets"
      impact: "50-70% reduction in page load time"

    - task: "Set up database connection pooling"
      impact: "Reduces connection overhead, improves concurrency"

    - task: "Configure browser caching headers"
      impact: "Faster repeat visits, reduced server load"

  monitoring_requirements:
    - metric: "CPU/RAM/Disk utilization (OS level)"
      tool: "CloudWatch, Azure Monitor, Stackdriver, or Prometheus"

    - metric: "Database query performance"
      tool: "pg_stat_statements, pgBadger"

    - metric: "Application response times"
      tool: "New Relic, Datadog, or custom APM"

    - metric: "User session metrics"
      tool: "Odoo built-in analytics + custom dashboards"

  cost_estimates:
    monthly_infrastructure:
      small: "$50-150/month (cloud VPS)"
      medium: "$200-500/month (separated tiers)"
      large: "$800-1500/month (load balanced)"
      enterprise: "$2000-5000/month (multi-region HA)"

    total_cost_of_ownership:
      note: "Include infrastructure, operations staff, backup storage, monitoring tools, and user productivity impact"

  estimated_time: "2-4 hours for capacity analysis and planning"
  complexity_level: "Intermediate to Advanced"

# AI-generated content sections (standardized 4-field structure)
ai_generated_content:
  introduction: ""      # Opening paragraph (from component library)
  main_content: ""      # Main capacity planning guide (from capacity_planning_templates.yml)
  conclusion: ""        # Closing paragraph (from component library)
  extended_content: ""  # Optional: FAQ, scaling examples, case studies

# Conversion assets
conversion_assets:
  - component_type: "callout-box"
    placement_hint: "after_architecture"
    generated_copy: {}

  - component_type: "benefit-list"
    placement_hint: "mid_content"
    generated_copy: {}

  - component_type: "inline-simple"
    placement_hint: "after_conclusion"
    generated_copy: {}

# Strategic internal links
intelligent_links:
  - link_type: "next_step"
    context: "Proceed with installation based on these specifications"
    generated_link: {}

  - link_type: "related_topic"
    context: "Optimize Odoo performance for your user count"
    generated_link: {}

  - link_type: "advanced_guide"
    context: "Advanced configuration for {{deployment_scale}} deployments"
    generated_link: {}

  - link_type: "troubleshooting"
    context: "Performance troubleshooting for high-user environments"
    generated_link: {}

# Visualizations
visualizations:
  - chart_type: "mermaid"
    placement_hint: "after_architecture"
    data_context: "architecture_diagram"
    mermaid_chart_syntax: ""
