# Template: Security Guide
# Template ID: security
# Intent Type: practitioner
# Variables Required: {{system}}, {{security_aspect}}, {{compliance_standard}}

metadata:
  title: "Secure {{system}}: {{security_aspect}} Best Practices 2025"
  description: "Harden {{system}} in under 2 hours. Reduce security risks by 70% with {{compliance_standard}}-compliant configuration, automated monitoring, and incident response. Enterprise-tested framework."
  intent_type: "practitioner"
  page_slug: "secure-{{system_slug}}-{{security_aspect_slug}}"
  draft_metadata:
    created_by: "pseo-bulk-generator"
    template_id: "security"
    generation_mode: "template"
    confidence_level: "high"

static_data:
  # New naming convention (used by main_content_templates)
  security_topic: "{{security_topic}}"
  security_context: "{{security_context}}"

  # Content section variables (for security_templates.yml)
  security_hardening_steps: "{{security_hardening_steps}}"
  vulnerability_management_process: "{{vulnerability_management_process}}"
  compliance_specific_requirements: "{{compliance_specific_requirements}}"
  incident_response_plan: "{{incident_response_plan}}"
  security_monitoring_details: "{{security_monitoring_details}}"
  security_conclusion: "{{security_conclusion}}"

  # Legacy naming (for backward compatibility)
  system_name: "{{system}}"
  security_focus: "{{security_aspect}}"
  compliance_requirement: "{{compliance_standard}}"

  security_assessment:
    risk_areas:
      - area: "Authentication & Authorization"
        current_risk: "{{auth_risk_level}}"
        vulnerabilities:
          - "Weak password policies"
          - "Missing MFA"
          - "Excessive permissions"

      - area: "Data Protection"
        current_risk: "{{data_risk_level}}"
        vulnerabilities:
          - "Unencrypted data at rest"
          - "Insecure data transmission"
          - "Inadequate backup security"

      - area: "Network Security"
        current_risk: "{{network_risk_level}}"
        vulnerabilities:
          - "Open unnecessary ports"
          - "Missing firewall rules"
          - "Unencrypted communications"

  security_hardening:
    - category: "System Hardening"
      measures:
        - measure: "Disable unnecessary services"
          commands:
            - "systemctl disable {{service_name}}"
            - "systemctl stop {{service_name}}"

        - measure: "Configure firewall rules"
          implementation: |
            # UFW firewall configuration
            ufw default deny incoming
            ufw default allow outgoing
            ufw allow 22/tcp
            ufw allow 443/tcp
            ufw enable

        - measure: "Kernel hardening"
          sysctl_config: |
            # /etc/sysctl.d/99-hardening.conf
            net.ipv4.tcp_syncookies = 1
            net.ipv4.conf.all.rp_filter = 1
            kernel.exec-shield = 1
            kernel.randomize_va_space = 2

    - category: "Application Security"
      measures:
        - measure: "Implement secure headers"
          nginx_config: |
            add_header X-Frame-Options "SAMEORIGIN" always;
            add_header X-Content-Type-Options "nosniff" always;
            add_header X-XSS-Protection "1; mode=block" always;
            add_header Strict-Transport-Security "max-age=31536000" always;

        - measure: "SQL injection prevention"
          code_example: |
            # Use parameterized queries
            cursor.execute(
                "SELECT * FROM users WHERE id = %s",
                (user_id,)
            )

        - measure: "Input validation"
          implementation: |
            import re
            def validate_input(user_input):
                # Whitelist approach
                if not re.match("^[a-zA-Z0-9_-]+$", user_input):
                    raise ValidationError("Invalid input")
                return user_input

    - category: "Access Control"
      measures:
        - measure: "Implement MFA"
          tools:
            - "Google Authenticator"
            - "Authy"
            - "Hardware tokens (YubiKey)"

        - measure: "Role-based access control (RBAC)"
          implementation: |
            # Define roles and permissions
            ROLES = {
                'admin': ['read', 'write', 'delete', 'configure'],
                'manager': ['read', 'write', 'delete'],
                'user': ['read', 'write'],
                'viewer': ['read']
            }

        - measure: "SSH key-based authentication"
          setup: |
            # Disable password authentication
            sed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
            systemctl restart sshd

  monitoring_and_detection:
    - tool: "Intrusion Detection System (IDS)"
      options:
        - name: "Fail2ban"
          configuration: |
            # /etc/fail2ban/jail.local
            [sshd]
            enabled = true
            maxretry = 3
            bantime = 3600

        - name: "OSSEC"
          features:
            - "File integrity monitoring"
            - "Log analysis"
            - "Rootkit detection"

    - tool: "Security Information and Event Management (SIEM)"
      options:
        - "ELK Stack (Elasticsearch, Logstash, Kibana)"
        - "Splunk"
        - "Graylog"
      key_metrics:
        - "Failed login attempts"
        - "Privilege escalation"
        - "Unusual network traffic"

  incident_response:
    - phase: "Detection"
      actions:
        - "Monitor alerts from IDS/SIEM"
        - "Regular security audits"
        - "User activity monitoring"

    - phase: "Containment"
      actions:
        - "Isolate affected systems"
        - "Disable compromised accounts"
        - "Block malicious IPs"

    - phase: "Eradication"
      actions:
        - "Remove malware/backdoors"
        - "Patch vulnerabilities"
        - "Reset compromised credentials"

    - phase: "Recovery"
      actions:
        - "Restore from clean backups"
        - "Rebuild affected systems"
        - "Verify system integrity"

    - phase: "Lessons Learned"
      actions:
        - "Document incident timeline"
        - "Update security policies"
        - "Implement preventive measures"

  compliance_checklist:
    - requirement: "{{compliance_requirement_1}}"
      implementation: "{{implementation_1}}"
      verification: "{{verification_method_1}}"

    - requirement: "{{compliance_requirement_2}}"
      implementation: "{{implementation_2}}"
      verification: "{{verification_method_2}}"

  security_tools:
    - category: "Vulnerability Scanning"
      tools:
        - "Nmap - Network scanning"
        - "OpenVAS - Vulnerability assessment"
        - "OWASP ZAP - Web application scanning"

    - category: "Penetration Testing"
      tools:
        - "Metasploit - Exploitation framework"
        - "Burp Suite - Web security testing"
        - "Kali Linux - Security testing distribution"

  estimated_implementation: "1-2 weeks"
  complexity_level: "Advanced"

# AI-generated content sections (standardized 4-field structure)
ai_generated_content:
  introduction: ""      # Opening paragraph (from component library)
  main_content: ""      # Main security hardening guide (from content_templates.py)
  conclusion: ""        # Closing paragraph (from component library)
  extended_content: ""  # Optional: FAQ, compliance checklist, etc.

# Conversion assets
conversion_assets:
  - component_type: "callout-box"
    placement_hint: "mid_guide"
    generated_copy: {}

  - component_type: "urgency-banner"
    placement_hint: "post_technical"
    generated_copy: {}

  - component_type: "inline-simple"
    placement_hint: "after_conclusion"
    generated_copy: {}

# Strategic internal links
intelligent_links:
  - link_type: "related_security"
    context: "Other {{system}} security guides"
    generated_link: {}

  - link_type: "compliance_resources"
    context: "{{compliance_standard}} compliance"
    generated_link: {}

# Visualizations
visualizations:
  - chart_type: "mermaid"
    placement_hint: "mid_content"
    data_context: "threat_model"
    mermaid_chart_syntax: ""
