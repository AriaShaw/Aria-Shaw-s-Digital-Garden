<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Load YAML data for this PSEO page -->
    {% assign page_data = site.data.pages[page.data_key] %}

    <title>{{ page_data.metadata.title | default: page.title }}</title>
    <meta name="description" content="{{ page_data.metadata.description }}">
    <meta name="author" content="{{ site.author }}">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:title" content="{{ page_data.metadata.title | default: page.title }}">
    <meta property="og:description" content="{{ page_data.metadata.description }}">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="{{ page.url | absolute_url }}">
    <meta property="twitter:title" content="{{ page_data.metadata.title | default: page.title }}">
    <meta property="twitter:description" content="{{ page_data.metadata.description }}">

    <link rel="canonical" href="{{ page.url | absolute_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/accessibility.css" | relative_url }}">
    <link rel="stylesheet" href="{{ "/assets/css/reading-experience.css" | relative_url }}">

    <!-- Preconnect to CDN for faster resource loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Hide unrendered Mermaid diagrams to prevent code flash -->
    <style>
      .mermaid {
        opacity: 0;
        min-height: 200px;
        max-height: 800px;
        overflow-y: auto;
        overflow-x: hidden;
        transition: opacity 0.3s ease-in;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 1rem;
        background: #f6f8fa;
        border-radius: 6px;
        margin: 2rem 0;
      }
      .mermaid.mermaid-rendered {
        opacity: 1;
      }
      /* Ensure mermaid SVG centers properly and scrolls smoothly */
      .mermaid svg {
        max-width: 100%;
        height: auto;
      }
      /* Custom scrollbar for better UX */
      .mermaid::-webkit-scrollbar {
        width: 8px;
      }
      .mermaid::-webkit-scrollbar-track {
        background: #e1e4e8;
        border-radius: 4px;
      }
      .mermaid::-webkit-scrollbar-thumb {
        background: #6c757d;
        border-radius: 4px;
      }
      .mermaid::-webkit-scrollbar-thumb:hover {
        background: #495057;
      }
    </style>

    <!-- Mermaid.js for visualizations - lazy loaded with IntersectionObserver -->
    <script type="module">
      document.addEventListener('DOMContentLoaded', () => {
        const mermaidContainers = document.querySelectorAll('.mermaid');
        if (mermaidContainers.length === 0) return;

        let mermaidLoaded = false;

        const loadAndRenderMermaid = async () => {
          if (mermaidLoaded) return;
          mermaidLoaded = true;

          try {
            const mermaid = await import('https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs');

            mermaid.default.initialize({
              startOnLoad: false,
              theme: 'neutral',
              securityLevel: 'loose',
              fontFamily: 'system-ui, -apple-system, sans-serif'
            });

            await mermaid.default.run({
              querySelector: '.mermaid'
            });

            mermaidContainers.forEach(container => {
              container.classList.add('mermaid-rendered');
            });
          } catch (error) {
            console.error('Mermaid rendering failed:', error);
            mermaidContainers.forEach(container => {
              container.style.opacity = '1';
              container.innerHTML = '<p style="color: #666; font-style: italic;">Diagram rendering failed. Please refresh the page.</p>';
            });
          }
        };

        const firstDiagram = mermaidContainers[0];
        const rect = firstDiagram.getBoundingClientRect();
        const isInViewport = rect.top < window.innerHeight && rect.bottom > 0;

        if (isInViewport) {
          loadAndRenderMermaid();
        } else {
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                loadAndRenderMermaid();
                observer.disconnect();
              }
            });
          }, { rootMargin: '200px' });
          observer.observe(firstDiagram);
        }
      });
    </script>

    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    {% include head-custom.html %}

    <!-- Enhanced Schema.org JSON-LD - Template-based (Google 2025 optimized) -->
    {% include schema-pseo.html page_data=page_data %}
  </head>
  <body class="post-layout pseo-page" data-accessibility="wcag-aa">
    <!-- Reading Progress Bar -->
    <div class="reading-progress" id="reading-progress"></div>

    <div class="wrapper">
      <!-- Floating Table of Contents -->
      <aside class="post-sidebar" aria-label="Table of Contents Navigation">
        {% include floating-toc.html %}
      </aside>

      <section>
        {% include breadcrumbs.html %}

        <!-- Mobile TOC -->
        <div class="mobile-toc-container">
          {% include floating-toc.html %}
        </div>

        <div class="post-meta">
          <small class="post-date">{{ site.time | date: "%-d %B %Y" }}</small>
          <small class="post-reading-time">
            <svg class="reading-time-icon" viewBox="0 0 16 16" width="12" height="12" aria-hidden="true">
              <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0zm7-3.25v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.751.751 0 0 1 7 8.25v-3.5a.75.75 0 0 1 1.5 0z"/>
            </svg>
            {% assign total_words = 0 %}
            {% for field in page_data.ai_generated_content %}
              {% assign words = field[1] | number_of_words %}
              {% assign total_words = total_words | plus: words %}
            {% endfor %}
            {% assign reading_time = total_words | divided_by: 225 %}
            {% if reading_time == 0 %}1{% else %}{{ reading_time }}{% endif %} min read
          </small>
        </div>

        <h1>{{ page_data.metadata.title }}</h1>

        <p class="view">by Aria Shaw</p>

        <!-- PSEO Content Rendering -->

        <!-- Introduction -->
        {% if page_data.ai_generated_content.introduction and page_data.ai_generated_content.introduction != "" %}
        {{ page_data.ai_generated_content.introduction | markdownify }}
        {% endif %}

        <!-- Visualizations: After Introduction -->
        {% if page_data.visualizations %}
          {% for viz in page_data.visualizations %}
            {% if viz.placement_hint == "after_introduction" and viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
            <div class="mermaid">
{{ viz.mermaid_chart_syntax }}
            </div>
            {% endif %}
          {% endfor %}
        {% endif %}

        <!-- CTA: After Introduction -->
        {% for asset in page_data.conversion_assets %}
          {% if asset.placement_hint == "after_introduction" %}
            {% include ctas/{{ asset.component_type }}.html
               copy=asset.generated_copy
               intent_type=page_data.metadata.intent_type
               location="after_introduction" %}
          {% endif %}
        {% endfor %}

        <!-- Main Content -->
        {% include pseo/content-renderer.html page_data=page_data %}

        <!-- Intelligent Links -->
        {% if page_data.intelligent_links and page_data.intelligent_links.size > 0 %}
        <section class="intelligent-links" aria-label="Related Resources">
          <h2>Related Resources</h2>
          <div class="link-grid">
            {% for link in page_data.intelligent_links %}
              {% if link.link_url and link.link_url != "" %}
              <div class="link-card">
                <h3 class="link-title">
                  <a href="{{ link.link_url }}">{{ link.anchor_text }}</a>
                </h3>
                {% if link.context and link.context != "" %}
                <p class="link-context">{{ link.context }}</p>
                {% endif %}
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </section>
        {% endif %}

        <!-- Product CTA Section (Dynamic based on page topic) -->
        {% assign page_slug = page_data.metadata.page_slug | downcase %}

        {% if page_slug contains "integrate" or page_slug contains "migration" or page_slug contains "migrate" or page_slug contains "upgrade" %}
          {% assign product_name = "Migration Toolkit" %}
          {% assign product_price = "$47" %}
          {% assign product_url = "https://ariashaw.gumroad.com/l/migration-toolkit" %}
          {% assign product_headline = "Automate Your Integration & Migration" %}
          {% assign product_body = "Manual integration setup is time-consuming and error-prone. The Migration Toolkit provides automated data mapping, validation, and sync procedures - cutting migration time by 10x while eliminating data loss risks." %}
          {% assign product_features = "5 Professional Scripts:|Incremental sync procedure (migrate while system stays live)|Parallel processing optimizer (10x faster than sequential)|Real-time progress monitoring with detailed logging|Data consistency checker (automatic validation)|Rapid rollback script (recovery in under 15 minutes)" %}

        {% elsif page_slug contains "backup" %}
          {% assign product_name = "Backup Protection Pack" %}
          {% assign product_price = "$27" %}
          {% assign product_url = "https://ariashaw.gumroad.com/l/backup-protection-pack" %}
          {% assign product_headline = "Never Lose Data Again" %}
          {% assign product_body = "Manual backups fail silently. The Backup Protection Pack provides automated scheduling, multi-cloud redundancy, and integrity validation - protecting your business from data loss disasters." %}
          {% assign product_features = "7 Professional Scripts:|Intelligent backup scheduler with system load awareness|Multi-cloud sync (AWS S3, Backblaze B2, Google Drive)|Incremental backup optimizer (80% faster, 60% less storage)|Automated integrity validation with ML-based anomaly detection|Disaster recovery drill system (test your backups work)|Cloud integration scripts for 3 enterprise providers" %}

        {% elsif page_slug contains "monitor" or page_slug contains "performance" or page_slug contains "optimization" %}
          {% assign product_name = "Performance Monitoring Suite" %}
          {% assign product_price = "$37" %}
          {% assign product_url = "https://ariashaw.gumroad.com/l/monitoring-suite" %}
          {% assign product_headline = "Catch Problems Before Users Do" %}
          {% assign product_body = "Reactive troubleshooting costs time and money. The Monitoring Suite provides real-time health checks, performance benchmarks, and automatic alerting - preventing outages before they happen." %}
          {% assign product_features = "8 Professional Scripts:|System health monitor (CPU/RAM/Disk/Network)|Performance benchmark tool (identify bottlenecks)|PostgreSQL query optimizer (auto-tune database)|NGINX performance booster (CDN-grade caching)|Redis cache configurator (10x speedup)|Log anomaly detector (ML-based error prediction)|Business metrics monitor (track orders, sales, KPIs)|Multi-channel alert system (Slack/Email/SMS/PagerDuty)" %}

        {% elsif page_slug contains "install" or page_slug contains "setup" or page_slug contains "deploy" or page_slug contains "configuration" %}
          {% assign product_name = "Production Config Pack" %}
          {% assign product_price = "$17" %}
          {% assign product_url = "https://ariashaw.gumroad.com/l/odoo-configs-pack" %}
          {% assign product_headline = "Skip Hours of Configuration Debugging" %}
          {% assign product_body = "Generic Odoo installations aren't production-ready. The Config Pack provides battle-tested configurations for NGINX, PostgreSQL, and Odoo - optimized for security, performance, and reliability." %}
          {% assign product_features = "5 Production Configs:|NGINX reverse proxy (SSL, caching, load balancing)|PostgreSQL tuning (optimized for Odoo workloads)|Odoo production settings (security hardened)|Systemd service files (auto-restart, logging)|Firewall rules (UFW/iptables security lockdown)" %}

        {% else %}
          {% assign product_name = "Digital Sovereignty Master Pack" %}
          {% assign product_price = "$699" %}
          {% assign product_url = "https://ariashaw.gumroad.com/l/odoo-digital-sovereignty-master-pack" %}
          {% assign product_headline = "Complete Enterprise Solution" %}
          {% assign product_body = "Stop piecing together solutions from random tutorials. The Master Pack provides everything you need for professional Odoo deployment, backup, monitoring, and disaster recovery - with ongoing support from Aria Shaw." %}
          {% assign product_features = "Complete Enterprise Suite:|68 integrated professional scripts and tools|2,000+ pages of comprehensive documentation|Direct email support from Aria Shaw|Lifetime updates and improvements|All 5 modules: Deployment, Migration, Backup, Monitoring, Operations" %}
        {% endif %}

        <div class="master-pack-section" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px; padding: 2.5rem; margin: 3rem 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h2 style="color: #1a202c; margin-top: 0;">{{ product_headline }}</h2>
          <p style="font-size: 1.1rem; color: #2d3748; line-height: 1.6;">{{ product_body }}</p>

          <h3 style="color: #267CB9; margin-top: 2rem;">What You Get</h3>
          {% assign features_array = product_features | split: "|" %}
          <ul class="features-list" style="list-style: none; padding-left: 0;">
            {% for feature in features_array %}
              {% if forloop.first %}
                <li style="border-bottom: 2px solid #267CB9; padding-bottom: 1rem; margin-bottom: 1rem; font-weight: 600; font-size: 1.1rem; color: #267CB9;">
                  {{ feature }}
                </li>
              {% else %}
                <li style="padding: 0.5rem 0; padding-left: 1.5rem; position: relative;">
                  <span style="position: absolute; left: 0; color: #48bb78;">✓</span>
                  <span style="color: #2d3748;">{{ feature }}</span>
                </li>
              {% endif %}
            {% endfor %}
          </ul>

          <div class="pricing-box" style="background: white; border-radius: 8px; padding: 1.5rem; margin-top: 2rem; border-left: 4px solid #267CB9;">
            <p style="margin: 0.5rem 0;"><strong style="color: #1a202c;">Investment:</strong> <span style="font-size: 1.3rem; color: #267CB9; font-weight: bold;">{{ product_price }}</span> one-time payment</p>
            {% if product_price == "$699" %}
            <p style="margin: 0.5rem 0;"><strong style="color: #1a202c;">What you avoid:</strong> $15,000-$50,000 in consultant fees + months of trial-and-error</p>
            <p style="margin: 0.5rem 0;"><strong style="color: #1a202c;">Includes:</strong> Complete enterprise solution with ongoing support</p>
            {% else %}
            <p style="margin: 0.5rem 0;"><strong style="color: #1a202c;">What you avoid:</strong> Hours of debugging, trial-and-error, and expensive consultants</p>
            <p style="margin: 0.5rem 0;"><strong style="color: #1a202c;">Guarantee:</strong> 30-day money-back guarantee. No questions asked.</p>
            {% endif %}
            <a href="{{ product_url }}" class="master-pack-button" style="display: inline-block; background: #267CB9; color: white; padding: 1rem 2rem; border-radius: 6px; text-decoration: none; font-weight: 600; margin-top: 1rem; transition: background 0.3s;">
              Get {{ product_name }} {{ product_price }} →
            </a>
          </div>
        </div>

        <!-- Final CTA -->
        {% for asset in page_data.conversion_assets %}
          {% if asset.placement_hint == "bottom_cta" or asset.placement_hint == "end_of_page" %}
            {% include ctas/{{ asset.component_type }}.html
               copy=asset.generated_copy
               intent_type=page_data.metadata.intent_type
               location="bottom_cta" %}
          {% endif %}
        {% endfor %}

        </main>

      <footer role="contentinfo" aria-label="Page Footer">
        {% if site.github.is_project_page %}
        <p>This project is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a></p>
        {% endif %}
      </footer>
    </div>
    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>

    <!-- Intent-specific conversion tracking -->
    <script>
      if (typeof gtag !== 'undefined') {
        gtag('event', 'pseo_page_view', {
          'intent_type': '{{ page_data.metadata.intent_type }}',
          'page_slug': '{{ page_data.metadata.page_slug }}',
          'page_path': '{{ page.url }}'
        });
      }
    </script>
  </body>
</html>
