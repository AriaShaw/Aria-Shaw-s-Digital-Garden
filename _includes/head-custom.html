<style>
    /* 1. Code Copy Button Styles */
    div.highlight {
        position: relative;
    }
    .copy-button {
        position: absolute;
        top: 0.5em;
        right: 0.5em;
        padding: 3px 8px;
        font-size: 12px;
        color: #e0e0e0;
        background-color: #333;
        border: 1px solid #555;
        border-radius: 5px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s ease-in-out, background-color 0.2s;
        z-index: 10;
    }
    div.highlight:hover .copy-button {
        opacity: 1;
    }
    .copy-button:hover {
        background-color: #444;
    }
    .copy-button.copied {
        background-color: #28a745;
        border-color: #1c7430;
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('div.highlight > pre').forEach((preElement) => {
            const codeBlockContainer = preElement.parentElement;
            if (codeBlockContainer.querySelector('.copy-button')) { return; }
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.textContent = 'Copy';
            codeBlockContainer.appendChild(copyButton);
            copyButton.addEventListener('click', (e) => {
                e.stopPropagation();
                const code = preElement.querySelector('code').innerText;
                navigator.clipboard.writeText(code).then(() => {
                    copyButton.textContent = 'Copied!';
                    copyButton.classList.add('copied');
                    setTimeout(() => {
                        copyButton.textContent = 'Copy';
                        copyButton.classList.remove('copied');
                    }, 2000);
                }).catch(err => { console.error('Failed to copy text: ', err); });
            });
        });
    });
</script>

<style>
    /* This style block only controls the TOC, not the entire site layout */
    #toc-sidebar {
        display: none; /* Hidden on small screens by default */
    }

    @media (min-width: 1280px) {
        /* On large screens, use a modern grid layout */
        .post-wrapper {
            display: grid;
            grid-template-columns: 1fr 280px; /* Main content | TOC sidebar */
            gap: 30px;
        }
        
        #toc-sidebar {
            display: block; /* Show the sidebar */
            order: 2; /* Place the TOC on the right */
        }

        .post-content-main {
            order: 1; /* Place the main content on the left */
        }
        
        .toc-container {
            position: sticky;
            top: 20px;
            max-height: 85vh;
            overflow-y: auto;
            border-left: 2px solid #e1e4e8;
            padding-left: 20px;
        }

        .toc-container h3 { margin-top: 0; font-size: 16px; font-weight: 600; }
        #toc ul { padding-left: 15px; margin: 0; }
        #toc li { list-style-type: none; margin-bottom: 8px; }
        #toc a { text-decoration: none; color: #586069; font-size: 14px; }
        #toc a:hover { color: #0366d6; }
        #toc .is-active-link { font-weight: 700; color: #0366d6; }
    }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.21.1/tocbot.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        if (document.querySelector('.post-content-main')) {
            tocbot.init({
                tocSelector: '#toc',
                contentSelector: '.post-content-main',
                headingSelector: 'h2, h3',
                scrollSmooth: true,
                activeLinkClass: 'is-active-link',
                headingsOffset: 40,
            });
        }
    });
</script>