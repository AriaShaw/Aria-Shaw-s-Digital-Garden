<!-- PSEO Content Renderer - Intent-Type Aware Dynamic Content Assembly -->
<!-- This include handles the rendering of AI-generated content based on the page's intent_type -->

{% assign data = include.page_data %}

<!-- RESEARCHER INTENT: Deep analysis, trust-building, comprehensive comparisons -->
{% if data.metadata.intent_type == "researcher" %}

  <!-- Sovereignty Analysis (if present) -->
  {% if data.ai_generated_content.sovereignty_analysis and data.ai_generated_content.sovereignty_analysis != "" %}
  <div class="sovereignty-analysis">
    <h2>Digital Sovereignty Analysis</h2>
    <div class="analysis-content">
      {{ data.ai_generated_content.sovereignty_analysis | markdownify }}
    </div>
  </div>
  {% endif %}

  <!-- Feature Comparison (if present in static_data) -->
  {% if data.static_data.feature_comparison %}
  <div class="feature-comparison">
    <h2>Feature Comparison</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0;">
      <thead>
        <tr style="background: #f6f8fa; border-bottom: 2px solid #d1d5da;">
          <th style="padding: 0.75rem; text-align: left;">Feature</th>
          {% for product in data.static_data.feature_comparison.products %}
          <th style="padding: 0.75rem; text-align: center;">{{ product.name }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for feature in data.static_data.feature_comparison.features %}
        <tr style="border-bottom: 1px solid #e1e4e8;">
          <td style="padding: 0.75rem; font-weight: 500;">{{ feature.name }}</td>
          {% for score in feature.scores %}
          <td style="padding: 0.75rem; text-align: center;">{{ score }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Detailed Analysis Section -->
  {% if data.ai_generated_content.detailed_analysis and data.ai_generated_content.detailed_analysis != "" %}
  <div class="detailed-analysis">
    <h2>Detailed Analysis</h2>
    {{ data.ai_generated_content.detailed_analysis | markdownify }}
  </div>
  {% endif %}

<!-- PRACTITIONER INTENT: Step-by-step guides, actionable instructions, technical details -->
{% elsif data.metadata.intent_type == "practitioner" %}

  <!-- Step-by-Step Guide (support multiple field name variants) -->
  {% assign guide_content = data.ai_generated_content.step_by_step_guide | default: data.ai_generated_content.deployment_guide | default: data.ai_generated_content.installation_guide | default: data.ai_generated_content.migration_guide | default: data.ai_generated_content.upgrade_guide %}
  {% if guide_content and guide_content != "" %}
  <div class="implementation-guide">
    <h2>{% if data.ai_generated_content.migration_guide and data.ai_generated_content.migration_guide != "" %}Migration Guide{% elsif data.ai_generated_content.upgrade_guide and data.ai_generated_content.upgrade_guide != "" %}Upgrade Guide{% else %}Implementation Guide{% endif %}</h2>
    {{ guide_content | markdownify }}
  </div>
  {% endif %}

  <!-- Structured Deployment Steps (if present in static_data) -->
  {% if data.static_data.deployment_steps %}
  <div class="deployment-steps">
    <h2>Deployment Steps</h2>
    {% for step in data.static_data.deployment_steps %}
    <div class="deployment-step" style="margin: 2rem 0; padding: 1.5rem; background: #f6f8fa; border-left: 4px solid #267CB9; border-radius: 4px;">
      <h3 style="margin-top: 0; color: #267CB9;">Step {{ step.step }}: {{ step.title }}</h3>

      {% if step.commands %}
      <div class="commands" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">Commands:</h4>
        <div class="highlight">
          <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{% for cmd in step.commands %}{{ cmd }}
{% endfor %}</code></pre>
        </div>
      </div>
      {% endif %}

      {% if step.config_snippet %}
      <div class="config" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">Configuration:</h4>
        <div class="highlight">
          <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{{ step.config_snippet }}</code></pre>
        </div>
      </div>
      {% endif %}

      {% if step.service_snippet %}
      <div class="service" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">Service File:</h4>
        <div class="highlight">
          <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{{ step.service_snippet }}</code></pre>
        </div>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- CTA: After Main Guide (mid_guide placement) -->
  {% for asset in data.conversion_assets %}
    {% if asset.placement_hint == "mid_guide" %}
      {% include ctas/{{ asset.component_type }}.html
         copy=asset.generated_copy
         intent_type=data.metadata.intent_type
         location="mid_guide" %}
    {% endif %}
  {% endfor %}

  <!-- Visualizations: After Steps -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_steps" or viz.placement_hint == "after_guide" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- Code Snippets / Scripts (if present) -->
  {% if data.ai_generated_content.docker_compose_generator and data.ai_generated_content.docker_compose_generator != "" %}
  <div class="code-section">
    <h3>Docker Compose Configuration</h3>
    <div class="highlight"><pre style="background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>{{ data.ai_generated_content.docker_compose_generator }}</code></pre></div>
  </div>
  {% endif %}

  {% if data.ai_generated_content.nginx_config_snippet and data.ai_generated_content.nginx_config_snippet != "" %}
  <div class="code-section">
    <h3>Nginx Configuration</h3>
    <div class="highlight"><pre style="background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>{{ data.ai_generated_content.nginx_config_snippet }}</code></pre></div>
  </div>
  {% endif %}

  <!-- Technical Specifications (if present in static_data) -->
  {% if data.static_data.server_specs %}
  <div class="server-specs">
    <h2>Server Specifications</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0;">
      <thead>
        <tr style="background: #f6f8fa; border-bottom: 2px solid #d1d5da;">
          <th style="padding: 0.75rem; text-align: left;">Plan</th>
          <th style="padding: 0.75rem; text-align: center;">vCPUs</th>
          <th style="padding: 0.75rem; text-align: center;">RAM (GB)</th>
          <th style="padding: 0.75rem; text-align: center;">Storage (GB)</th>
          <th style="padding: 0.75rem; text-align: right;">Price</th>
        </tr>
      </thead>
      <tbody>
        {% for spec in data.static_data.server_specs %}
        <tr style="border-bottom: 1px solid #e1e4e8;">
          <td style="padding: 0.75rem; font-weight: 500;">{{ spec.plan }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.vcpus }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.ram_gb }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.storage_gb }}</td>
          <td style="padding: 0.75rem; text-align: right;">${{ spec.price_usd_monthly }}/mo</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Visualizations: After Specs / After Server Specs Discussion -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_specs" or viz.placement_hint == "after_server_specs" or viz.placement_hint == "after_server_specs_discussion" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}
  {% endif %}

  <!-- Common Mistakes / Troubleshooting -->
  {% if data.ai_generated_content.common_mistakes and data.ai_generated_content.common_mistakes != "" %}
  <div class="troubleshooting" style="background: #fff5f5; border-left: 4px solid #d73a49; padding: 1.5rem; margin: 2rem 0;">
    <h3 style="margin-top: 0; color: #d73a49;">Common Mistakes to Avoid</h3>
    {{ data.ai_generated_content.common_mistakes | markdownify }}
  </div>
  {% endif %}

  <!-- Common Pitfalls (from static_data) -->
  {% if data.static_data.common_pitfalls %}
  <div class="common-pitfalls" style="background: #fffbf0; border-left: 4px solid #f9826c; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #c24e00;">Common Pitfalls</h2>
    {% for pitfall in data.static_data.common_pitfalls %}
    <div class="pitfall-item" style="margin: 1.5rem 0; padding-bottom: 1rem; border-bottom: 1px solid #f4dcc9;">
      <h4 style="color: #c24e00; margin-bottom: 0.5rem;">{{ pitfall.issue }}</h4>
      <p style="margin: 0.5rem 0;"><strong>Solution:</strong> {{ pitfall.solution }}</p>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Security Best Practices -->
  {% if data.static_data.security_best_practices %}
  <div class="security-practices" style="background: #f0f9ff; border-left: 4px solid #0969da; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #0969da;">Security Best Practices</h2>
    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
    {% for practice in data.static_data.security_best_practices %}
      {% if practice.item %}
        <li style="margin: 0.5rem 0;">
          {{ practice.item }}
          {% if practice.critical == true %}
          <span style="color: #d73a49; font-weight: 600; margin-left: 0.5rem;">[Critical]</span>
          {% endif %}
        </li>
      {% else %}
        <li style="margin: 0.5rem 0;">{{ practice }}</li>
      {% endif %}
    {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Cost Estimate -->
  {% if data.static_data.cost_estimate %}
  <div class="cost-estimate" style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 6px; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0;">Cost Estimate</h2>
    <table style="width: 100%; border-collapse: collapse;">
      {% if data.static_data.cost_estimate.monthly_server_cost %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Monthly Server Cost:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.monthly_server_cost }}</td>
      </tr>
      {% endif %}
      {% if data.static_data.cost_estimate.setup_cost %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Setup Cost:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.setup_cost }}</td>
      </tr>
      {% endif %}
      {% if data.static_data.cost_estimate.ongoing_costs %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Ongoing Costs:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.ongoing_costs }}</td>
      </tr>
      {% endif %}
    </table>
  </div>
  {% endif %}

  <!-- Alternative Deployment Options -->
  {% if data.static_data.alternative_deployment_options %}
  <div class="alternatives" style="margin: 2rem 0;">
    <h2>Alternative Deployment Options</h2>
    {% for alt in data.static_data.alternative_deployment_options %}
    <div class="alternative-option" style="background: #f6f8fa; border-radius: 6px; padding: 1.25rem; margin: 1rem 0;">
      <h3 style="margin-top: 0; color: #267CB9;">{{ alt.option }}</h3>
      <p style="margin: 0.5rem 0;"><strong>Pros:</strong> {{ alt.pros }}</p>
      <p style="margin: 0.5rem 0;"><strong>Cons:</strong> {{ alt.cons }}</p>
      {% if alt.link %}
      <p style="margin: 0.5rem 0;"><a href="/guides/{{ alt.link }}/" style="color: #0969da;">Learn more â†’</a></p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Next Steps -->
  {% if data.static_data.next_steps %}
  <div class="next-steps" style="background: #dafbe1; border-left: 4px solid #1a7f37; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #1a7f37;">Next Steps</h2>
    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
    {% for step in data.static_data.next_steps %}
      <li style="margin: 0.5rem 0;">{{ step }}</li>
    {% endfor %}
    </ol>
  </div>
  {% endif %}

  <!-- Visualizations: After Common Mistakes / Before Troubleshooting -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_common_mistakes" or viz.placement_hint == "before_troubleshooting" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- Troubleshooting Guide -->
  {% if data.ai_generated_content.troubleshooting_guide and data.ai_generated_content.troubleshooting_guide != "" %}
  <div class="troubleshooting-guide">
    <h2>Troubleshooting</h2>
    {{ data.ai_generated_content.troubleshooting_guide | markdownify }}
  </div>
  {% endif %}

  <!-- CTA: Post Technical (post_technical placement) -->
  {% for asset in data.conversion_assets %}
    {% if asset.placement_hint == "post_technical" %}
      {% include ctas/{{ asset.component_type }}.html
         copy=asset.generated_copy
         intent_type=data.metadata.intent_type
         location="post_technical" %}
    {% endif %}
  {% endfor %}

  <!-- Visualizations: After Troubleshooting / Mid Content / Other -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_troubleshooting" or viz.placement_hint == "mid_content" or viz.placement_hint == "after_cost_analysis_section" or viz.placement_hint == "after_server_specs_discussion" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

<!-- DECIDER INTENT: ROI focus, business outcomes, calculator tools -->
{% elsif data.metadata.intent_type == "decider" %}

  <!-- TCO Analysis -->
  {% if data.ai_generated_content.cost_analysis_text and data.ai_generated_content.cost_analysis_text != "" %}
  <div class="tco-analysis">
    <h2>Total Cost of Ownership Analysis</h2>
    {{ data.ai_generated_content.cost_analysis_text | markdownify }}
  </div>
  {% endif %}

  <!-- ROI Calculator (if present in static_data) -->
  {% if data.static_data.tco_breakdown %}
  <div class="tco-breakdown">
    <h2>Cost Breakdown</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <thead>
        <tr style="background: #267CB9; color: white;">
          <th style="padding: 1rem; text-align: left;">Cost Category</th>
          <th style="padding: 1rem; text-align: right;">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for item in data.static_data.tco_breakdown %}
        <tr style="border-bottom: 1px solid #e1e4e8;">
          <td style="padding: 0.75rem;">{{ item.category }}</td>
          <td style="padding: 0.75rem; text-align: right; font-weight: 600;">${{ item.amount }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Business Value Proposition -->
  {% if data.ai_generated_content.business_value and data.ai_generated_content.business_value != "" %}
  <div class="business-value" style="background: linear-gradient(135deg, #f6f8fa 0%, #ffffff 100%); border: 2px solid #267CB9; border-radius: 8px; padding: 2rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #267CB9;">Business Value</h2>
    {{ data.ai_generated_content.business_value | markdownify }}
  </div>
  {% endif %}

{% endif %}

<!-- Visualizations: Catch-all for any remaining placement hints (before conclusion) -->
<!-- MAINTENANCE NOTE: If you add a new placement_hint section above, you MUST add it to the exclusion list below -->
<!-- Current exclusions: after_introduction, after_steps, after_guide, after_specs, after_server_specs, -->
<!-- after_server_specs_discussion, after_common_mistakes, before_troubleshooting, after_troubleshooting, -->
<!-- mid_content, after_cost_analysis_section -->
<!-- Also update .claude/agents/pseo-visualization-agent.md with any new placement hints -->
{% if data.visualizations %}
  {% for viz in data.visualizations %}
    {% unless viz.placement_hint == "after_introduction" or viz.placement_hint == "after_steps" or viz.placement_hint == "after_guide" or viz.placement_hint == "after_specs" or viz.placement_hint == "after_server_specs" or viz.placement_hint == "after_server_specs_discussion" or viz.placement_hint == "after_common_mistakes" or viz.placement_hint == "before_troubleshooting" or viz.placement_hint == "after_troubleshooting" or viz.placement_hint == "mid_content" or viz.placement_hint == "after_cost_analysis_section" %}
      {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
      <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
      </div>
      {% endif %}
    {% endunless %}
  {% endfor %}
{% endif %}

<!-- CTA: Pre Conclusion (pre_conclusion placement) -->
{% for asset in data.conversion_assets %}
  {% if asset.placement_hint == "pre_conclusion" %}
    {% include ctas/{{ asset.component_type }}.html
       copy=asset.generated_copy
       intent_type=data.metadata.intent_type
       location="pre_conclusion" %}
  {% endif %}
{% endfor %}

<!-- Conclusion (common to all intent types) -->
{% if data.ai_generated_content.conclusion and data.ai_generated_content.conclusion != "" %}
<div class="conclusion" style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e1e4e8;">
  <h2>Conclusion</h2>
  {{ data.ai_generated_content.conclusion | markdownify }}
</div>
{% endif %}
