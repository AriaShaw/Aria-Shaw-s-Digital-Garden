<!-- Enhanced PSEO Content Renderer - Backward Compatible with Multiple Template Formats -->
<!-- Supports both legacy field names and new standardized template field names -->

{% assign data = include.page_data %}

<!-- RESEARCHER INTENT: Deep analysis, trust-building, comprehensive comparisons -->
{% if data.metadata.intent_type == "researcher" or data.metadata.intent_type == "problem_solver" %}

  <!-- Sovereignty Analysis (if present) -->
  {% if data.ai_generated_content.sovereignty_analysis and data.ai_generated_content.sovereignty_analysis != "" %}
  <div class="sovereignty-analysis">
    <h2>Digital Sovereignty Analysis</h2>
    <div class="analysis-content">
      {{ data.ai_generated_content.sovereignty_analysis | markdownify }}
    </div>
  </div>
  {% endif %}

  <!-- Feature Comparison (support multiple field names) -->
  {% assign feature_comp = data.static_data.feature_comparison | default: data.static_data.comparison_criteria %}
  {% if feature_comp %}
  <div class="feature-comparison">
    <h2>Feature Comparison</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0;">
      <thead>
        <tr style="background: #f6f8fa; border-bottom: 2px solid #d1d5da;">
          <th style="padding: 0.75rem; text-align: left;">
            {% if feature_comp.first.criteria %}Criteria{% else %}Feature{% endif %}
          </th>
          {% if feature_comp.products %}
            {% for product in feature_comp.products %}
            <th style="padding: 0.75rem; text-align: center;">{{ product.name }}</th>
            {% endfor %}
          {% elsif feature_comp.first.product_a %}
            <th style="padding: 0.75rem; text-align: center;">{{ data.static_data.product_a | default: "Product A" }}</th>
            <th style="padding: 0.75rem; text-align: center;">{{ data.static_data.product_b | default: "Product B" }}</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% if feature_comp.features %}
          {% for feature in feature_comp.features %}
          <tr style="border-bottom: 1px solid #e1e4e8;">
            <td style="padding: 0.75rem; font-weight: 500;">{{ feature.name | default: feature.feature }}</td>
            {% for score in feature.scores %}
            <td style="padding: 0.75rem; text-align: center;">{{ score }}</td>
            {% endfor %}
          </tr>
          {% endfor %}
        {% elsif feature_comp.first.criteria %}
          {% for item in feature_comp %}
          <tr style="border-bottom: 1px solid #e1e4e8;">
            <td style="padding: 0.75rem; font-weight: 500;">{{ item.criteria }}</td>
            <td style="padding: 0.75rem; text-align: center;">{{ item.product_a_score | default: item.product_a }}</td>
            <td style="padding: 0.75rem; text-align: center;">{{ item.product_b_score | default: item.product_b }}</td>
          </tr>
          {% endfor %}
        {% endif %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Detailed Analysis Section (support multiple field names) -->
  {% assign analysis_content = data.ai_generated_content.detailed_analysis | default: data.ai_generated_content.problem_analysis | default: data.ai_generated_content.executive_summary %}
  {% if analysis_content and analysis_content != "" %}
  <div class="detailed-analysis">
    <h2>Detailed Analysis</h2>
    {{ analysis_content | markdownify }}
  </div>
  {% endif %}

<!-- PRACTITIONER INTENT: Step-by-step guides, actionable instructions, technical details -->
{% elsif data.metadata.intent_type == "practitioner" or data.metadata.intent_type == "auto" %}

  <!-- Step-by-Step Guide (support ALL possible field name variants) -->
  {% assign guide_content = data.ai_generated_content.step_by_step_guide | default: data.ai_generated_content.deployment_guide | default: data.ai_generated_content.installation_guide | default: data.ai_generated_content.migration_guide | default: data.ai_generated_content.upgrade_guide | default: data.ai_generated_content.configuration_overview | default: data.ai_generated_content.development_overview | default: data.ai_generated_content.implementation_guide | default: data.ai_generated_content.integration_overview | default: data.ai_generated_content.performance_analysis | default: data.ai_generated_content.security_architecture | default: data.ai_generated_content.main_content %}

  {% if guide_content and guide_content != "" %}
  <div class="implementation-guide">
    <h2>
      {% if data.ai_generated_content.migration_guide and data.ai_generated_content.migration_guide != "" %}
        Migration Guide
      {% elsif data.ai_generated_content.upgrade_guide and data.ai_generated_content.upgrade_guide != "" %}
        Upgrade Guide
      {% elsif data.ai_generated_content.integration_overview and data.ai_generated_content.integration_overview != "" %}
        Integration Guide
      {% elsif data.ai_generated_content.configuration_overview and data.ai_generated_content.configuration_overview != "" %}
        Configuration Guide
      {% elsif data.ai_generated_content.development_overview and data.ai_generated_content.development_overview != "" %}
        Development Guide
      {% else %}
        Implementation Guide
      {% endif %}
    </h2>
    {{ guide_content | markdownify }}
  </div>
  {% endif %}

  <!-- Structured Steps (support ALL step field variants) -->
  {% assign steps = data.static_data.deployment_steps | default: data.static_data.installation_steps | default: data.static_data.integration_steps | default: data.static_data.configuration_sections | default: data.static_data.configuration_workflows | default: data.static_data.migration_phases | default: data.static_data.development_workflow | default: data.static_data.optimization_workflow | default: data.static_data.optimization_areas | default: data.static_data.security_hardening | default: data.static_data.diagnostic_steps | default: data.static_data.practical_guide %}

  {% if steps %}
  <div class="deployment-steps">
    <h2>
      {% if data.static_data.installation_steps %}Installation Steps
      {% elsif data.static_data.integration_steps %}Integration Steps
      {% elsif data.static_data.configuration_sections or data.static_data.configuration_workflows %}Configuration Steps
      {% elsif data.static_data.migration_phases %}Migration Phases
      {% elsif data.static_data.development_workflow %}Development Workflow
      {% elsif data.static_data.optimization_workflow or data.static_data.optimization_areas %}Optimization Steps
      {% elsif data.static_data.security_hardening %}Security Hardening Steps
      {% elsif data.static_data.diagnostic_steps %}Diagnostic Steps
      {% else %}Implementation Steps
      {% endif %}
    </h2>

    {% for step in steps %}
    <div class="deployment-step" style="margin: 2rem 0; padding: 1.5rem; background: #f6f8fa; border-left: 4px solid #267CB9; border-radius: 4px;">
      <!-- Handle different step structures -->
      {% if step.step %}
        <h3 style="margin-top: 0; color: #267CB9;">Step {{ step.step }}: {{ step.title | default: step.name }}</h3>
      {% elsif step.phase %}
        <h3 style="margin-top: 0; color: #267CB9;">Phase {{ step.phase }}: {{ step.name | default: step.title }}</h3>
      {% elsif step.area %}
        <h3 style="margin-top: 0; color: #267CB9;">{{ step.area }}</h3>
      {% elsif step.category %}
        <h3 style="margin-top: 0; color: #267CB9;">{{ step.category }}</h3>
      {% elsif step.section %}
        <h3 style="margin-top: 0; color: #267CB9;">{{ step.section }}</h3>
      {% else %}
        <h3 style="margin-top: 0; color: #267CB9;">{{ step.title | default: step.name }}</h3>
      {% endif %}

      <!-- Commands (support multiple field names) -->
      {% assign commands = step.commands | default: step.tasks | default: step.actions %}
      {% if commands %}
      <div class="commands" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">
          {% if step.tasks %}Tasks:{% else %}Commands:{% endif %}
        </h4>
        {% if commands.first %}
          {% if step.tasks %}
            <ul>
            {% for cmd in commands %}
              <li>{{ cmd }}</li>
            {% endfor %}
            </ul>
          {% else %}
            <div class="highlight">
              <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{% for cmd in commands %}{{ cmd }}
{% endfor %}</code></pre>
            </div>
          {% endif %}
        {% else %}
          <div class="highlight">
            <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{{ commands }}</code></pre>
          </div>
        {% endif %}
      </div>
      {% endif %}

      <!-- Configuration (support multiple field names) -->
      {% assign config = step.config_snippet | default: step.configuration | default: step.implementation | default: step.config_file %}
      {% if config and config != step.config_file %}
      <div class="config" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">Configuration:</h4>
        <div class="highlight">
          <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{{ config }}</code></pre>
        </div>
      </div>
      {% endif %}

      <!-- Service snippet -->
      {% if step.service_snippet %}
      <div class="service" style="margin: 1rem 0;">
        <h4 style="font-size: 0.95rem; color: #586069; margin-bottom: 0.5rem;">Service File:</h4>
        <div class="highlight">
          <pre style="background: #ffffff; padding: 1rem; border-radius: 4px; overflow-x: auto; border: 1px solid #d1d5da;"><code>{{ step.service_snippet }}</code></pre>
        </div>
      </div>
      {% endif %}

      <!-- Handle nested techniques/measures/settings for new templates -->
      {% if step.techniques %}
        {% for technique in step.techniques %}
        <div style="margin: 1rem 0; padding: 1rem; background: white; border: 1px solid #d1d5da; border-radius: 4px;">
          <h4 style="margin-top: 0;">{{ technique.technique | default: technique.name }}</h4>
          {% if technique.implementation %}
            <div class="highlight">
              <pre style="background: #f6f8fa; padding: 0.75rem; border-radius: 4px;"><code>{{ technique.implementation }}</code></pre>
            </div>
          {% endif %}
          {% if technique.expected_improvement %}
            <p style="margin: 0.5rem 0;"><strong>Expected Improvement:</strong> {{ technique.expected_improvement }}</p>
          {% endif %}
        </div>
        {% endfor %}
      {% endif %}

      {% if step.measures %}
        {% for measure in step.measures %}
        <div style="margin: 1rem 0; padding: 1rem; background: white; border: 1px solid #d1d5da; border-radius: 4px;">
          <h4 style="margin-top: 0;">{{ measure.measure | default: measure.name }}</h4>
          {% if measure.commands %}
            <div class="highlight">
              <pre style="background: #f6f8fa; padding: 0.75rem; border-radius: 4px;"><code>{% for cmd in measure.commands %}{{ cmd }}
{% endfor %}</code></pre>
            </div>
          {% endif %}
          {% if measure.implementation %}
            <div class="highlight">
              <pre style="background: #f6f8fa; padding: 0.75rem; border-radius: 4px;"><code>{{ measure.implementation }}</code></pre>
            </div>
          {% endif %}
        </div>
        {% endfor %}
      {% endif %}

      {% if step.settings %}
        {% for setting in step.settings %}
        <div style="margin: 0.75rem 0; padding: 0.75rem; background: white; border-left: 3px solid #0969da;">
          <strong>{{ setting.name }}:</strong>
          {% if setting.recommended %}
            <span style="color: #1a7f37;">{{ setting.recommended }}</span> (recommended)
          {% elsif setting.value %}
            {{ setting.value }}
          {% else %}
            {{ setting.default }} (default)
          {% endif %}
          {% if setting.description %}
            <br><small style="color: #586069;">{{ setting.description }}</small>
          {% endif %}
        </div>
        {% endfor %}
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Prerequisites (new template field) -->
  {% if data.static_data.prerequisites %}
  <div class="prerequisites" style="background: #f0f9ff; border-left: 4px solid #0969da; padding: 1.5rem; margin: 2rem 0;">
    <h3 style="margin-top: 0; color: #0969da;">Prerequisites</h3>
    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
    {% for prereq in data.static_data.prerequisites %}
      <li style="margin: 0.5rem 0;">{{ prereq }}</li>
    {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Visualizations: After Prerequisites (Phase 1 preparation charts) -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_prerequisites" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- System Requirements (new template field) -->
  {% if data.static_data.system_requirements %}
  <div class="system-requirements" style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 6px; padding: 1.5rem; margin: 2rem 0;">
    <h3 style="margin-top: 0;">System Requirements</h3>
    {% if data.static_data.system_requirements.minimum %}
    <div style="margin: 1rem 0;">
      <h4 style="color: #c24e00; margin-bottom: 0.5rem;">Minimum Requirements</h4>
      <table style="width: 100%;">
        <tr><td style="padding: 0.25rem 0;">CPU:</td><td>{{ data.static_data.system_requirements.minimum.cpu }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">RAM:</td><td>{{ data.static_data.system_requirements.minimum.ram }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">Storage:</td><td>{{ data.static_data.system_requirements.minimum.disk }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">OS Version:</td><td>{{ data.static_data.system_requirements.minimum.os_version }}</td></tr>
      </table>
    </div>
    {% endif %}
    {% if data.static_data.system_requirements.recommended %}
    <div style="margin: 1rem 0;">
      <h4 style="color: #1a7f37; margin-bottom: 0.5rem;">Recommended Requirements</h4>
      <table style="width: 100%;">
        <tr><td style="padding: 0.25rem 0;">CPU:</td><td>{{ data.static_data.system_requirements.recommended.cpu }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">RAM:</td><td>{{ data.static_data.system_requirements.recommended.ram }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">Storage:</td><td>{{ data.static_data.system_requirements.recommended.disk }}</td></tr>
        <tr><td style="padding: 0.25rem 0;">OS Version:</td><td>{{ data.static_data.system_requirements.recommended.os_version }}</td></tr>
      </table>
    </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- CTA: After Main Guide (mid_guide placement) -->
  {% for asset in data.conversion_assets %}
    {% if asset.placement_hint == "mid_guide" or asset.placement_hint == "before_steps" %}
      {% include ctas/{{ asset.component_type }}.html
         copy=asset.generated_copy
         intent_type=data.metadata.intent_type
         location="mid_guide" %}
    {% endif %}
  {% endfor %}

  <!-- Visualizations: After Steps / After Configuration -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_steps" or viz.placement_hint == "after_guide" or viz.placement_hint == "after_architecture" or viz.placement_hint == "after_diagnostic_steps" or viz.placement_hint == "after_configuration" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- Code Snippets / Scripts (if present) -->
  {% if data.ai_generated_content.docker_compose_generator and data.ai_generated_content.docker_compose_generator != "" %}
  <div class="code-section">
    <h3>Docker Compose Configuration</h3>
    <div class="highlight"><pre style="background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>{{ data.ai_generated_content.docker_compose_generator }}</code></pre></div>
  </div>
  {% endif %}

  {% if data.ai_generated_content.nginx_config_snippet and data.ai_generated_content.nginx_config_snippet != "" %}
  <div class="code-section">
    <h3>Nginx Configuration</h3>
    <div class="highlight"><pre style="background: #f6f8fa; padding: 1rem; border-radius: 6px; overflow-x: auto;"><code>{{ data.ai_generated_content.nginx_config_snippet }}</code></pre></div>
  </div>
  {% endif %}

  <!-- Technical Specifications (if present in static_data) -->
  {% if data.static_data.server_specs %}
  <div class="server-specs">
    <h2>Server Specifications</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0;">
      <thead>
        <tr style="background: #f6f8fa; border-bottom: 2px solid #d1d5da;">
          <th style="padding: 0.75rem; text-align: left;">Plan</th>
          <th style="padding: 0.75rem; text-align: center;">vCPUs</th>
          <th style="padding: 0.75rem; text-align: center;">RAM (GB)</th>
          <th style="padding: 0.75rem; text-align: center;">Storage (GB)</th>
          <th style="padding: 0.75rem; text-align: right;">Price</th>
        </tr>
      </thead>
      <tbody>
        {% for spec in data.static_data.server_specs %}
        <tr style="border-bottom: 1px solid #e1e4e8;">
          <td style="padding: 0.75rem; font-weight: 500;">{{ spec.plan }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.vcpus }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.ram_gb }}</td>
          <td style="padding: 0.75rem; text-align: center;">{{ spec.storage_gb }}</td>
          <td style="padding: 0.75rem; text-align: right;">${{ spec.price_usd_monthly }}/mo</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Visualizations: After Specs / After Server Specs Discussion -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_specs" or viz.placement_hint == "after_server_specs" or viz.placement_hint == "after_server_specs_discussion" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}
  {% endif %}

  <!-- Common Solutions (new template field for troubleshooting) -->
  {% if data.static_data.common_solutions %}
  <div class="common-solutions" style="background: #fff5f5; border-left: 4px solid #d73a49; padding: 1.5rem; margin: 2rem 0;">
    <h3 style="margin-top: 0; color: #d73a49;">Common Solutions</h3>
    {% for solution in data.static_data.common_solutions %}
    <div style="margin: 1.5rem 0; padding-bottom: 1rem; border-bottom: 1px solid #fcdcdb;">
      <h4 style="color: #d73a49;">{{ solution.error_pattern | default: solution.scenario }}</h4>
      <p><strong>Solution:</strong> {{ solution.solution }}</p>
      {% if solution.commands %}
        <div class="highlight">
          <pre style="background: white; padding: 0.75rem; border: 1px solid #fcdcdb;"><code>{% for cmd in solution.commands %}{{ cmd }}
{% endfor %}</code></pre>
        </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Common Mistakes / Troubleshooting -->
  {% if data.ai_generated_content.common_mistakes and data.ai_generated_content.common_mistakes != "" %}
  <div class="troubleshooting" style="background: #fff5f5; border-left: 4px solid #d73a49; padding: 1.5rem; margin: 2rem 0;">
    <h3 style="margin-top: 0; color: #d73a49;">Common Mistakes to Avoid</h3>
    {{ data.ai_generated_content.common_mistakes | markdownify }}
  </div>
  {% endif %}

  <!-- Common Pitfalls (from static_data) -->
  {% assign pitfalls = data.static_data.common_pitfalls | default: data.static_data.common_issues | default: data.static_data.common_mistakes %}
  {% if pitfalls %}
  <div class="common-pitfalls" style="background: #fffbf0; border-left: 4px solid #f9826c; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #c24e00;">
      {% if data.static_data.common_issues %}Common Issues{% else %}Common Pitfalls{% endif %}
    </h2>
    {% for pitfall in pitfalls %}
    <div class="pitfall-item" style="margin: 1.5rem 0; padding-bottom: 1rem; border-bottom: 1px solid #f4dcc9;">
      <h4 style="color: #c24e00; margin-bottom: 0.5rem;">{{ pitfall.issue | default: pitfall.mistake }}</h4>
      <p style="margin: 0.5rem 0;"><strong>Solution:</strong> {{ pitfall.solution | default: pitfall.consequence }}</p>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Security Best Practices (support multiple field names) -->
  {% assign security_practices = data.static_data.security_best_practices | default: data.static_data.best_practices %}
  {% if security_practices %}
  <div class="security-practices" style="background: #f0f9ff; border-left: 4px solid #0969da; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #0969da;">
      {% if data.static_data.security_best_practices %}Security Best Practices{% else %}Best Practices{% endif %}
    </h2>
    <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
    {% for practice in security_practices %}
      {% if practice.item %}
        <li style="margin: 0.5rem 0;">
          {{ practice.item }}
          {% if practice.critical == true %}
          <span style="color: #d73a49; font-weight: 600; margin-left: 0.5rem;">[Critical]</span>
          {% endif %}
        </li>
      {% elsif practice.practice %}
        <li style="margin: 0.5rem 0;">
          <strong>{{ practice.practice }}:</strong> {{ practice.implementation | default: practice.description }}
        </li>
      {% else %}
        <li style="margin: 0.5rem 0;">{{ practice }}</li>
      {% endif %}
    {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- Cost Estimate -->
  {% if data.static_data.cost_estimate %}
  <div class="cost-estimate" style="background: #f6f8fa; border: 1px solid #d1d5da; border-radius: 6px; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0;">Cost Estimate</h2>
    <table style="width: 100%; border-collapse: collapse;">
      {% if data.static_data.cost_estimate.monthly_server_cost %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Monthly Server Cost:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.monthly_server_cost }}</td>
      </tr>
      {% endif %}
      {% if data.static_data.cost_estimate.setup_cost %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Setup Cost:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.setup_cost }}</td>
      </tr>
      {% endif %}
      {% if data.static_data.cost_estimate.ongoing_costs %}
      <tr>
        <td style="padding: 0.5rem 0; font-weight: 500;">Ongoing Costs:</td>
        <td style="padding: 0.5rem 0; text-align: right;">{{ data.static_data.cost_estimate.ongoing_costs }}</td>
      </tr>
      {% endif %}
    </table>
  </div>
  {% endif %}

  <!-- Alternative Deployment Options (support multiple field names) -->
  {% assign alternatives = data.static_data.alternative_deployment_options | default: data.static_data.alternative_options | default: data.static_data.alternatives %}
  {% if alternatives %}
  <div class="alternatives" style="margin: 2rem 0;">
    <h2>Alternative Options</h2>
    {% for alt in alternatives %}
    <div class="alternative-option" style="background: #f6f8fa; border-radius: 6px; padding: 1.25rem; margin: 1rem 0;">
      <h3 style="margin-top: 0; color: #267CB9;">{{ alt.option | default: alt.name }}</h3>
      <p style="margin: 0.5rem 0;"><strong>Pros:</strong> {{ alt.pros | default: alt.advantages }}</p>
      <p style="margin: 0.5rem 0;"><strong>Cons:</strong> {{ alt.cons | default: alt.disadvantages }}</p>
      {% if alt.link %}
      <p style="margin: 0.5rem 0;"><a href="/guides/{{ alt.link }}/" style="color: #0969da;">Learn more →</a></p>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Next Steps -->
  {% if data.static_data.next_steps %}
  <div class="next-steps" style="background: #dafbe1; border-left: 4px solid #1a7f37; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #1a7f37;">Next Steps</h2>
    <ol style="margin: 0.5rem 0; padding-left: 1.5rem;">
    {% for step in data.static_data.next_steps %}
      <li style="margin: 0.5rem 0;">{{ step }}</li>
    {% endfor %}
    </ol>
  </div>
  {% endif %}

  <!-- Post-Installation Tasks (new template field) -->
  {% if data.static_data.post_installation %}
  <div class="post-installation" style="background: #dafbe1; border-left: 4px solid #1a7f37; padding: 1.5rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #1a7f37;">Post-Installation Tasks</h2>
    {% for task in data.static_data.post_installation %}
    <div style="margin: 0.75rem 0;">
      <strong>{{ task.task }}:</strong>
      {% if task.priority == 'High' %}
        <span style="color: #d73a49;">[{{ task.priority }}]</span>
      {% elsif task.priority == 'Medium' %}
        <span style="color: #f9826c;">[{{ task.priority }}]</span>
      {% else %}
        <span style="color: #586069;">[{{ task.priority }}]</span>
      {% endif %}
      {% if task.guide_link %}
        <br><a href="/guides/{{ task.guide_link }}/" style="color: #0969da;">View Guide →</a>
      {% endif %}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Visualizations: After Common Mistakes / Before Troubleshooting -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_common_mistakes" or viz.placement_hint == "before_troubleshooting" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <!-- Troubleshooting Guide (support multiple field names) -->
  {% assign troubleshooting = data.ai_generated_content.troubleshooting_guide | default: data.ai_generated_content.troubleshooting_tips | default: data.ai_generated_content.prevention_guide %}
  {% if troubleshooting and troubleshooting != "" %}
  <div class="troubleshooting-guide">
    <h2>Troubleshooting</h2>
    {{ troubleshooting | markdownify }}
  </div>
  {% endif %}

  <!-- CTA: Post Technical (post_technical placement) -->
  {% for asset in data.conversion_assets %}
    {% if asset.placement_hint == "post_technical" or asset.placement_hint == "after_verification" %}
      {% include ctas/{{ asset.component_type }}.html
         copy=asset.generated_copy
         intent_type=data.metadata.intent_type
         location="post_technical" %}
    {% endif %}
  {% endfor %}

  <!-- Visualizations: After Troubleshooting / Mid Content / Other -->
  {% if data.visualizations %}
    {% for viz in data.visualizations %}
      {% if viz.placement_hint == "after_troubleshooting" or viz.placement_hint == "mid_content" or viz.placement_hint == "after_cost_analysis_section" or viz.placement_hint == "after_server_specs_discussion" %}
        {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
        <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
        </div>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endif %}

<!-- DECIDER INTENT: ROI focus, business outcomes, calculator tools -->
{% elsif data.metadata.intent_type == "decider" %}

  <!-- TCO Analysis -->
  {% if data.ai_generated_content.cost_analysis_text and data.ai_generated_content.cost_analysis_text != "" %}
  <div class="tco-analysis">
    <h2>Total Cost of Ownership Analysis</h2>
    {{ data.ai_generated_content.cost_analysis_text | markdownify }}
  </div>
  {% endif %}

  <!-- ROI Calculator (if present in static_data) -->
  {% if data.static_data.tco_breakdown %}
  <div class="tco-breakdown">
    <h2>Cost Breakdown</h2>
    <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
      <thead>
        <tr style="background: #267CB9; color: white;">
          <th style="padding: 1rem; text-align: left;">Cost Category</th>
          <th style="padding: 1rem; text-align: right;">Amount</th>
        </tr>
      </thead>
      <tbody>
        {% for item in data.static_data.tco_breakdown %}
        <tr style="border-bottom: 1px solid #e1e4e8;">
          <td style="padding: 0.75rem;">{{ item.category }}</td>
          <td style="padding: 0.75rem; text-align: right; font-weight: 600;">${{ item.amount }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Business Value Proposition -->
  {% if data.ai_generated_content.business_value and data.ai_generated_content.business_value != "" %}
  <div class="business-value" style="background: linear-gradient(135deg, #f6f8fa 0%, #ffffff 100%); border: 2px solid #267CB9; border-radius: 8px; padding: 2rem; margin: 2rem 0;">
    <h2 style="margin-top: 0; color: #267CB9;">Business Value</h2>
    {{ data.ai_generated_content.business_value | markdownify }}
  </div>
  {% endif %}

{% endif %}

<!-- FAQ Section (new template field) -->
{% if data.static_data.faq %}
<div class="faq-section" style="margin: 2rem 0;">
  <h2>Frequently Asked Questions</h2>
  {% for item in data.static_data.faq %}
  <div style="margin: 1.5rem 0; padding: 1rem; background: #f6f8fa; border-radius: 6px;">
    <h4 style="margin-top: 0; color: #0969da;">{{ item.question }}</h4>
    <p style="margin: 0.5rem 0;">{{ item.answer }}</p>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Visualizations: Catch-all for any remaining placement hints (before conclusion) -->
{% if data.visualizations %}
  {% for viz in data.visualizations %}
    {% unless viz.placement_hint == "after_introduction" or viz.placement_hint == "after_prerequisites" or viz.placement_hint == "after_steps" or viz.placement_hint == "after_guide" or viz.placement_hint == "after_configuration" or viz.placement_hint == "after_specs" or viz.placement_hint == "after_server_specs" or viz.placement_hint == "after_server_specs_discussion" or viz.placement_hint == "after_common_mistakes" or viz.placement_hint == "before_troubleshooting" or viz.placement_hint == "after_troubleshooting" or viz.placement_hint == "mid_content" or viz.placement_hint == "after_cost_analysis_section" or viz.placement_hint == "after_architecture" or viz.placement_hint == "after_diagnostic_steps" or viz.placement_hint == "after_conclusion" %}
      {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
      <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
      </div>
      {% endif %}
    {% endunless %}
  {% endfor %}
{% endif %}

<!-- CTA: Pre Conclusion (pre_conclusion placement) -->
{% for asset in data.conversion_assets %}
  {% if asset.placement_hint == "pre_conclusion" or asset.placement_hint == "after_conclusion" %}
    {% include ctas/{{ asset.component_type }}.html
       copy=asset.generated_copy
       intent_type=data.metadata.intent_type
       location="pre_conclusion" %}
  {% endif %}
{% endfor %}

<!-- Conclusion (support multiple field names) -->
{% assign conclusion = data.ai_generated_content.conclusion | default: data.ai_generated_content.summary | default: data.ai_generated_content.final_thoughts %}
{% if conclusion and conclusion != "" %}
<div class="conclusion" style="margin-top: 3rem; padding-top: 2rem; border-top: 2px solid #e1e4e8;">
  <h2>Conclusion</h2>
  {{ conclusion | markdownify }}
</div>
{% endif %}

<!-- Visualizations: After Conclusion (learning path, next steps navigation) -->
{% if data.visualizations %}
  {% for viz in data.visualizations %}
    {% if viz.placement_hint == "after_conclusion" %}
      {% if viz.mermaid_chart_syntax and viz.mermaid_chart_syntax != "" %}
      <div class="mermaid" style="text-align: center; max-height: 600px; overflow: auto; background: #f6f8fa; padding: 1rem; border-radius: 6px; margin: 2rem 0;">
{{ viz.mermaid_chart_syntax }}
      </div>
      {% endif %}
    {% endif %}
  {% endfor %}
{% endif %}